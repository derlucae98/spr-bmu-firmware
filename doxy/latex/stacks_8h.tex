\hypertarget{stacks_8h}{}\doxysection{include/stacks.h File Reference}
\label{stacks_8h}\index{include/stacks.h@{include/stacks.h}}


Module which acquires the stack values. The values are provided via a Mutex protected global variable.  


{\ttfamily \#include \char`\"{}Free\+RTOS.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}task.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}semphr.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}config.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}LTC6811.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}spi.\+h\char`\"{}}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
Include dependency graph for stacks.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{stacks_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=168pt]{stacks_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structstacks__data__t}{stacks\+\_\+data\+\_\+t}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{stacks_8h_ab3041e301367c91b7f4b7db2c6989f5f}{MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+SLAVES}}~12
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{stacks_8h_a78fdb4c2cdafba4696c2a6a0da558845}{init\+\_\+stacks}} (void)
\begin{DoxyCompactList}\small\item\em Initializes the LTC6811 library and reads the unique ID. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{stacks_8h_aabf463ce77d1c20dc5dbb39e8bf3e6ed}{control\+\_\+balancing}} (bool enabled)
\begin{DoxyCompactList}\small\item\em Global enable or disable for the cell balancing. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{stacks_8h_ac99fac1270344e147f33864e1da25153}{get\+\_\+balancing\+\_\+status}} (uint8\+\_\+t gates\mbox{[}\mbox{\hyperlink{_l_t_c6811_8h_ae8917e4694b50aff9d8b1cf3de93d5c0}{NUMBEROFSLAVES}}\mbox{]}\mbox{[}\mbox{\hyperlink{_l_t_c6811_8h_ac3447b6da089862e9efd9e742443bd5f}{MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+CELLS}}\mbox{]})
\begin{DoxyCompactList}\small\item\em Get the currently set balancing gates. The balancing algorithm is executed in this module. This function reports the currently set balancing gates for a visual feedback in the control software. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structstacks__data__t}{stacks\+\_\+data\+\_\+t}} $\ast$ \mbox{\hyperlink{stacks_8h_a2199a8aada9ff14aced446806302701d}{get\+\_\+stacks\+\_\+data}} (Tick\+Type\+\_\+t blocktime)
\begin{DoxyCompactList}\small\item\em Returns a pointer to the variable containing the stack values. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{stacks_8h_a59ef0488c28f3170bf6d360abf7ab85e}{copy\+\_\+stacks\+\_\+data}} (\mbox{\hyperlink{structstacks__data__t}{stacks\+\_\+data\+\_\+t}} $\ast$dest, Tick\+Type\+\_\+t blocktime)
\begin{DoxyCompactList}\small\item\em Copy the global stacks\+\_\+data variable to a local variable. This function works similar to \mbox{\hyperlink{stacks_8h_a2199a8aada9ff14aced446806302701d}{get\+\_\+stacks\+\_\+data()}};. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{stacks_8h_a3b36054e34985d7389ef71ac430fcd23}{release\+\_\+stacks\+\_\+data}} (void)
\begin{DoxyCompactList}\small\item\em Release the Mutex of the global variable. Call this function after accessing the variable. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Module which acquires the stack values. The values are provided via a Mutex protected global variable. 



\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{stacks_8h_ab3041e301367c91b7f4b7db2c6989f5f}\label{stacks_8h_ab3041e301367c91b7f4b7db2c6989f5f}} 
\index{stacks.h@{stacks.h}!MAX\_NUM\_OF\_SLAVES@{MAX\_NUM\_OF\_SLAVES}}
\index{MAX\_NUM\_OF\_SLAVES@{MAX\_NUM\_OF\_SLAVES}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{MAX\_NUM\_OF\_SLAVES}{MAX\_NUM\_OF\_SLAVES}}
{\footnotesize\ttfamily \#define MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+SLAVES~12}

Defines the number of slaves during normal operation. NUMBEROFSLAVES can be different from this value. This is useful during development when only one slave is available for testing on the bench. To ensure that the software will work with NUMBEROFSLAVES != 12, MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+SLAVES defines the number of slaves during normal operation. If NUMBEROFSLAVES is less than this value, all unused values in the arrays are filled with 0. Note that a greater value for NUMBEROFSLAVES than MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+SLAVES will lead to crashes 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{stacks_8h_aabf463ce77d1c20dc5dbb39e8bf3e6ed}\label{stacks_8h_aabf463ce77d1c20dc5dbb39e8bf3e6ed}} 
\index{stacks.h@{stacks.h}!control\_balancing@{control\_balancing}}
\index{control\_balancing@{control\_balancing}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{control\_balancing()}{control\_balancing()}}
{\footnotesize\ttfamily void control\+\_\+balancing (\begin{DoxyParamCaption}\item[{bool}]{enabled }\end{DoxyParamCaption})}



Global enable or disable for the cell balancing. 


\begin{DoxyParams}{Parameters}
{\em enabled} & Set this value to true to enable the balancing. Set to false to disable balancing. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{stacks_8h_a59ef0488c28f3170bf6d360abf7ab85e}\label{stacks_8h_a59ef0488c28f3170bf6d360abf7ab85e}} 
\index{stacks.h@{stacks.h}!copy\_stacks\_data@{copy\_stacks\_data}}
\index{copy\_stacks\_data@{copy\_stacks\_data}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{copy\_stacks\_data()}{copy\_stacks\_data()}}
{\footnotesize\ttfamily bool copy\+\_\+stacks\+\_\+data (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structstacks__data__t}{stacks\+\_\+data\+\_\+t}} $\ast$}]{dest,  }\item[{Tick\+Type\+\_\+t}]{blocktime }\end{DoxyParamCaption})}



Copy the global stacks\+\_\+data variable to a local variable. This function works similar to \mbox{\hyperlink{stacks_8h_a2199a8aada9ff14aced446806302701d}{get\+\_\+stacks\+\_\+data()}};. 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//Example:}}
\DoxyCodeLine{\mbox{\hyperlink{structstacks__data__t}{stacks\_data\_t}} stacksDataLocal;}
\DoxyCodeLine{\mbox{\hyperlink{stacks_8h_a59ef0488c28f3170bf6d360abf7ab85e}{copy\_stacks\_data}}(\&stacksDataLocal, portMAX\_DELAY);}

\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em dest} & Pointer to the destination variable \\
\hline
{\em blocktime} & Specify a timeout in which the Mutex must become available. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns true on success and false on failure. 
\end{DoxyReturn}
\mbox{\Hypertarget{stacks_8h_ac99fac1270344e147f33864e1da25153}\label{stacks_8h_ac99fac1270344e147f33864e1da25153}} 
\index{stacks.h@{stacks.h}!get\_balancing\_status@{get\_balancing\_status}}
\index{get\_balancing\_status@{get\_balancing\_status}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{get\_balancing\_status()}{get\_balancing\_status()}}
{\footnotesize\ttfamily void get\+\_\+balancing\+\_\+status (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{gates\mbox{[}\+NUMBEROFSLAVES\mbox{]}\mbox{[}\+MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+CELLS\mbox{]} }\end{DoxyParamCaption})}



Get the currently set balancing gates. The balancing algorithm is executed in this module. This function reports the currently set balancing gates for a visual feedback in the control software. 


\begin{DoxyParams}{Parameters}
{\em gates} & Provide an array of size \mbox{[}NUMBEROFSLAVES\mbox{]}\mbox{[}MAX\+\_\+\+NUM\+\_\+\+OF\+\_\+\+CELLS\mbox{]} in which the data will be stored. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{stacks_8h_a2199a8aada9ff14aced446806302701d}\label{stacks_8h_a2199a8aada9ff14aced446806302701d}} 
\index{stacks.h@{stacks.h}!get\_stacks\_data@{get\_stacks\_data}}
\index{get\_stacks\_data@{get\_stacks\_data}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{get\_stacks\_data()}{get\_stacks\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structstacks__data__t}{stacks\+\_\+data\+\_\+t}}$\ast$ get\+\_\+stacks\+\_\+data (\begin{DoxyParamCaption}\item[{Tick\+Type\+\_\+t}]{blocktime }\end{DoxyParamCaption})}



Returns a pointer to the variable containing the stack values. 


\begin{DoxyParams}{Parameters}
{\em blocktime} & Specify a timeout in which the Mutex must become available. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns a pointer to the variable if the Mutex could be obtained. Otherwise NULL. 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//Example:}}
\DoxyCodeLine{\mbox{\hyperlink{structstacks__data__t}{stacks\_data\_t}}* stacksData = \mbox{\hyperlink{stacks_8h_a2199a8aada9ff14aced446806302701d}{get\_stacks\_data}}(portMAX\_DELAY);}
\DoxyCodeLine{\textcolor{keywordflow}{if} (stacksData != NULL) \{}
\DoxyCodeLine{    \textcolor{comment}{//Use stacksData}}
\DoxyCodeLine{    \mbox{\hyperlink{stacks_8h_a3b36054e34985d7389ef71ac430fcd23}{release\_stacks\_data}}();}
\DoxyCodeLine{\}}

\end{DoxyCode}
 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Always check the return value for NULL before dereferencing it! 
\end{DoxyNote}
\mbox{\Hypertarget{stacks_8h_a78fdb4c2cdafba4696c2a6a0da558845}\label{stacks_8h_a78fdb4c2cdafba4696c2a6a0da558845}} 
\index{stacks.h@{stacks.h}!init\_stacks@{init\_stacks}}
\index{init\_stacks@{init\_stacks}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{init\_stacks()}{init\_stacks()}}
{\footnotesize\ttfamily void init\+\_\+stacks (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes the LTC6811 library and reads the unique ID. 

\begin{DoxyNote}{Note}
This function must be called before any other function in this module can be used! 
\end{DoxyNote}
\mbox{\Hypertarget{stacks_8h_a3b36054e34985d7389ef71ac430fcd23}\label{stacks_8h_a3b36054e34985d7389ef71ac430fcd23}} 
\index{stacks.h@{stacks.h}!release\_stacks\_data@{release\_stacks\_data}}
\index{release\_stacks\_data@{release\_stacks\_data}!stacks.h@{stacks.h}}
\doxysubsubsection{\texorpdfstring{release\_stacks\_data()}{release\_stacks\_data()}}
{\footnotesize\ttfamily void release\+\_\+stacks\+\_\+data (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Release the Mutex of the global variable. Call this function after accessing the variable. 

\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{stacks_8h_a2199a8aada9ff14aced446806302701d}{get\+\_\+stacks\+\_\+data()}} 
\end{DoxySeeAlso}
