<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SPR23e BMU firmware: include/stacks.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SPR23e BMU firmware
   </div>
   <div id="projectbrief">Firmware for the Battery Management System of the SPR23e</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('stacks_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">stacks.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Module which acquires the stack values. The values are provided via a Mutex protected global variable.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;FreeRTOS.h&quot;</code><br />
<code>#include &quot;task.h&quot;</code><br />
<code>#include &quot;semphr.h&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_l_t_c6811_8h_source.html">LTC6811.h</a>&quot;</code><br />
<code>#include &quot;spi.h&quot;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for stacks.h:</div>
<div class="dyncontent">
<div class="center"><img src="stacks_8h__incl.png" border="0" usemap="#ainclude_2stacks_8h" alt=""/></div>
<map name="ainclude_2stacks_8h" id="ainclude_2stacks_8h">
<area shape="rect" title="Module which acquires the stack values. The values are provided via a Mutex protected global variable..." alt="" coords="268,5,385,32"/>
<area shape="rect" title=" " alt="" coords="5,155,101,181"/>
<area shape="rect" title=" " alt="" coords="125,155,184,181"/>
<area shape="rect" title=" " alt="" coords="208,155,283,181"/>
<area shape="rect" href="config_8h.html" title=" " alt="" coords="446,80,514,107"/>
<area shape="rect" href="_l_t_c6811_8h.html" title="Library for the LTC6811 battery stack monitor This Library is designed for a specific hardware." alt="" coords="283,80,370,107"/>
<area shape="rect" title=" " alt="" coords="576,155,651,181"/>
<area shape="rect" title=" " alt="" coords="539,80,589,107"/>
<area shape="rect" title=" " alt="" coords="307,155,375,181"/>
<area shape="rect" title=" " alt="" coords="399,155,465,181"/>
<area shape="rect" title=" " alt="" coords="489,155,551,181"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="stacks_8h__dep__incl.png" border="0" usemap="#ainclude_2stacks_8hdep" alt=""/></div>
<map name="ainclude_2stacks_8hdep" id="ainclude_2stacks_8hdep">
<area shape="rect" title="Module which acquires the stack values. The values are provided via a Mutex protected global variable..." alt="" coords="5,5,123,32"/>
<area shape="rect" href="bmu_8h.html" title=" " alt="" coords="13,80,115,107"/>
</map>
</div>
</div>
<p><a href="stacks_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structstacks__data__t.html">stacks_data_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab3041e301367c91b7f4b7db2c6989f5f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#ab3041e301367c91b7f4b7db2c6989f5f">MAX_NUM_OF_SLAVES</a>&#160;&#160;&#160;12</td></tr>
<tr class="separator:ab3041e301367c91b7f4b7db2c6989f5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a78fdb4c2cdafba4696c2a6a0da558845"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#a78fdb4c2cdafba4696c2a6a0da558845">init_stacks</a> (void)</td></tr>
<tr class="memdesc:a78fdb4c2cdafba4696c2a6a0da558845"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the LTC6811 library and reads the unique ID.  <a href="stacks_8h.html#a78fdb4c2cdafba4696c2a6a0da558845">More...</a><br /></td></tr>
<tr class="separator:a78fdb4c2cdafba4696c2a6a0da558845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf463ce77d1c20dc5dbb39e8bf3e6ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#aabf463ce77d1c20dc5dbb39e8bf3e6ed">control_balancing</a> (bool enabled)</td></tr>
<tr class="memdesc:aabf463ce77d1c20dc5dbb39e8bf3e6ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global enable or disable for the cell balancing.  <a href="stacks_8h.html#aabf463ce77d1c20dc5dbb39e8bf3e6ed">More...</a><br /></td></tr>
<tr class="separator:aabf463ce77d1c20dc5dbb39e8bf3e6ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac99fac1270344e147f33864e1da25153"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#ac99fac1270344e147f33864e1da25153">get_balancing_status</a> (uint8_t gates[<a class="el" href="_l_t_c6811_8h.html#ae8917e4694b50aff9d8b1cf3de93d5c0">NUMBEROFSLAVES</a>][<a class="el" href="_l_t_c6811_8h.html#ac3447b6da089862e9efd9e742443bd5f">MAX_NUM_OF_CELLS</a>])</td></tr>
<tr class="memdesc:ac99fac1270344e147f33864e1da25153"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the currently set balancing gates. The balancing algorithm is executed in this module. This function reports the currently set balancing gates for a visual feedback in the control software.  <a href="stacks_8h.html#ac99fac1270344e147f33864e1da25153">More...</a><br /></td></tr>
<tr class="separator:ac99fac1270344e147f33864e1da25153"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2199a8aada9ff14aced446806302701d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structstacks__data__t.html">stacks_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#a2199a8aada9ff14aced446806302701d">get_stacks_data</a> (TickType_t blocktime)</td></tr>
<tr class="memdesc:a2199a8aada9ff14aced446806302701d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a pointer to the variable containing the stack values.  <a href="stacks_8h.html#a2199a8aada9ff14aced446806302701d">More...</a><br /></td></tr>
<tr class="separator:a2199a8aada9ff14aced446806302701d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59ef0488c28f3170bf6d360abf7ab85e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#a59ef0488c28f3170bf6d360abf7ab85e">copy_stacks_data</a> (<a class="el" href="structstacks__data__t.html">stacks_data_t</a> *dest, TickType_t blocktime)</td></tr>
<tr class="memdesc:a59ef0488c28f3170bf6d360abf7ab85e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the global stacks_data variable to a local variable. This function works similar to <a class="el" href="stacks_8h.html#a2199a8aada9ff14aced446806302701d" title="Returns a pointer to the variable containing the stack values.">get_stacks_data()</a>;.  <a href="stacks_8h.html#a59ef0488c28f3170bf6d360abf7ab85e">More...</a><br /></td></tr>
<tr class="separator:a59ef0488c28f3170bf6d360abf7ab85e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b36054e34985d7389ef71ac430fcd23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stacks_8h.html#a3b36054e34985d7389ef71ac430fcd23">release_stacks_data</a> (void)</td></tr>
<tr class="memdesc:a3b36054e34985d7389ef71ac430fcd23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the Mutex of the global variable. Call this function after accessing the variable.  <a href="stacks_8h.html#a3b36054e34985d7389ef71ac430fcd23">More...</a><br /></td></tr>
<tr class="separator:a3b36054e34985d7389ef71ac430fcd23"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Module which acquires the stack values. The values are provided via a Mutex protected global variable. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab3041e301367c91b7f4b7db2c6989f5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3041e301367c91b7f4b7db2c6989f5f">&#9670;&nbsp;</a></span>MAX_NUM_OF_SLAVES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_NUM_OF_SLAVES&#160;&#160;&#160;12</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defines the number of slaves during normal operation. NUMBEROFSLAVES can be different from this value. This is useful during development when only one slave is available for testing on the bench. To ensure that the software will work with NUMBEROFSLAVES != 12, MAX_NUM_OF_STACKS defines the number of slaves during normal operation. If NUMBEROFSLAVES is less than this value, all unused values in the arrays are filled with 0. Note that a greater value for NUMBEROFSLAVES than MAX_NUM_OF_SLAVES will lead to crashes </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aabf463ce77d1c20dc5dbb39e8bf3e6ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabf463ce77d1c20dc5dbb39e8bf3e6ed">&#9670;&nbsp;</a></span>control_balancing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void control_balancing </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global enable or disable for the cell balancing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enabled</td><td>Set this value to true to enable the balancing. Set to false to disable balancing. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a59ef0488c28f3170bf6d360abf7ab85e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59ef0488c28f3170bf6d360abf7ab85e">&#9670;&nbsp;</a></span>copy_stacks_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool copy_stacks_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstacks__data__t.html">stacks_data_t</a> *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TickType_t&#160;</td>
          <td class="paramname"><em>blocktime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy the global stacks_data variable to a local variable. This function works similar to <a class="el" href="stacks_8h.html#a2199a8aada9ff14aced446806302701d" title="Returns a pointer to the variable containing the stack values.">get_stacks_data()</a>;. </p>
<div class="fragment"><div class="line"><span class="comment">//Example:</span></div>
<div class="line"><a class="code" href="structstacks__data__t.html">stacks_data_t</a> stacksDataLocal;</div>
<div class="line"><a class="code" href="stacks_8h.html#a59ef0488c28f3170bf6d360abf7ab85e">copy_stacks_data</a>(&amp;stacksDataLocal, portMAX_DELAY);</div>
<div class="ttc" id="astacks_8h_html_a59ef0488c28f3170bf6d360abf7ab85e"><div class="ttname"><a href="stacks_8h.html#a59ef0488c28f3170bf6d360abf7ab85e">copy_stacks_data</a></div><div class="ttdeci">bool copy_stacks_data(stacks_data_t *dest, TickType_t blocktime)</div><div class="ttdoc">Copy the global stacks_data variable to a local variable. This function works similar to get_stacks_d...</div></div>
<div class="ttc" id="astructstacks__data__t_html"><div class="ttname"><a href="structstacks__data__t.html">stacks_data_t</a></div><div class="ttdef"><b>Definition:</b> stacks.h:60</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="ac99fac1270344e147f33864e1da25153"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac99fac1270344e147f33864e1da25153">&#9670;&nbsp;</a></span>get_balancing_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_balancing_status </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>gates</em>[NUMBEROFSLAVES][MAX_NUM_OF_CELLS]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the currently set balancing gates. The balancing algorithm is executed in this module. This function reports the currently set balancing gates for a visual feedback in the control software. </p>

</div>
</div>
<a id="a2199a8aada9ff14aced446806302701d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2199a8aada9ff14aced446806302701d">&#9670;&nbsp;</a></span>get_stacks_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structstacks__data__t.html">stacks_data_t</a>* get_stacks_data </td>
          <td>(</td>
          <td class="paramtype">TickType_t&#160;</td>
          <td class="paramname"><em>blocktime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a pointer to the variable containing the stack values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blocktime</td><td>Specify a timeout in which the Mutex must become available. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a pointer to the variable if the Mutex could be obtained. Otherwise NULL. <div class="fragment"><div class="line"><span class="comment">//Example:</span></div>
<div class="line"><a class="code" href="structstacks__data__t.html">stacks_data_t</a>* stacksData = <a class="code" href="stacks_8h.html#a2199a8aada9ff14aced446806302701d">get_stacks_data</a>(portMAX_DELAY);</div>
<div class="line"><span class="keywordflow">if</span> (stacksData != NULL) {</div>
<div class="line">    <span class="comment">//Use stacksData</span></div>
<div class="line">    <a class="code" href="stacks_8h.html#a3b36054e34985d7389ef71ac430fcd23">release_stacks_data</a>();</div>
<div class="line">}</div>
<div class="ttc" id="astacks_8h_html_a2199a8aada9ff14aced446806302701d"><div class="ttname"><a href="stacks_8h.html#a2199a8aada9ff14aced446806302701d">get_stacks_data</a></div><div class="ttdeci">stacks_data_t * get_stacks_data(TickType_t blocktime)</div><div class="ttdoc">Returns a pointer to the variable containing the stack values.</div></div>
<div class="ttc" id="astacks_8h_html_a3b36054e34985d7389ef71ac430fcd23"><div class="ttname"><a href="stacks_8h.html#a3b36054e34985d7389ef71ac430fcd23">release_stacks_data</a></div><div class="ttdeci">void release_stacks_data(void)</div><div class="ttdoc">Release the Mutex of the global variable. Call this function after accessing the variable.</div></div>
</div><!-- fragment --> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Always check the return value for NULL before dereferencing it! </dd></dl>

</div>
</div>
<a id="a78fdb4c2cdafba4696c2a6a0da558845"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78fdb4c2cdafba4696c2a6a0da558845">&#9670;&nbsp;</a></span>init_stacks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_stacks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the LTC6811 library and reads the unique ID. </p>
<dl class="section note"><dt>Note</dt><dd>This function must be called before any other function in this module can be used! </dd></dl>

</div>
</div>
<a id="a3b36054e34985d7389ef71ac430fcd23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b36054e34985d7389ef71ac430fcd23">&#9670;&nbsp;</a></span>release_stacks_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void release_stacks_data </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release the Mutex of the global variable. Call this function after accessing the variable. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="stacks_8h.html#a2199a8aada9ff14aced446806302701d" title="Returns a pointer to the variable containing the stack values.">get_stacks_data()</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="stacks_8h.html">stacks.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
